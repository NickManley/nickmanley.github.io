var Pong=Pong||{};Pong.Configuration=function(){"use strict";this.ball={width:10,height:10,posX:400,posY:300,speedX:400,speedY:0,color:"#FFF"};this.leftPaddle={width:15,height:100,posX:10,posY:250,moveSpeed:500,color:"#FFF"};this.rightPaddle={width:15,height:100,posX:775,posY:250,moveSpeed:500,color:"#FFF"};this.scoreboard={fontFace:"Arial",fontSize:"20px",fontColor:"#FFF",leftPos:{x:200,y:30},rightPos:{x:600,y:30}};this.controls={upKey:"w",downKey:"s",pauseKey:"p",resetKey:"r"}};var Pong=Pong||{};Pong.Rectangle=function(e){"use strict";this.context=e;this.color="#FFF";this.width=0;this.height=0;this.posX=0;this.posY=0;this.speedX=0;this.speedY=0;this.accumTimeX=0;this.accumTimeY=0};Pong.Rectangle.prototype.setPosition=function(e,t){"use strict";var n=0;var r=0;var i=this.context.canvas.width-this.width;var s=this.context.canvas.height-this.height;if(e<n){this.posX=n}else if(e>i){this.posX=i}else{this.posX=e}if(t<r){this.posY=r}else if(t>s){this.posY=s}else{this.posY=t}};Pong.Rectangle.prototype.isOverlapping=function(e){"use strict";var t=function(e){return{x1:e.posX,y1:e.posY,x2:e.posX+e.width,y2:e.posY+e.height}};var n=t(this);var r=t(e);return n.x1<=r.x2&&n.x2>=r.x1&&n.y1<=r.y2&&n.y2>=r.y1};Pong.Rectangle.prototype.setSpeed=function(e,t){"use strict";this.speedX=e;this.speedY=t};Pong.Rectangle.prototype.move=function(e,t){"use strict";this.setPosition(this.posX+e,this.posY+t)};Pong.Rectangle.prototype.update=function(e){"use strict";this.accumTimeX+=this.speedX!==0?e:0;this.accumTimeY+=this.speedY!==0?e:0;var t=Math.abs(1e3/this.speedX);var n=Math.abs(1e3/this.speedY);if(this.accumTimeX>=t){var r=parseInt(this.accumTimeX/(1e3/this.speedX));this.move(r,0);this.accumTimeX=0}if(this.accumTimeY>=n){var i=parseInt(this.accumTimeY/(1e3/this.speedY));this.move(0,i);this.accumTimeY=0}};Pong.Rectangle.prototype.draw=function(){"use strict";this.context.fillStyle=this.color;this.context.fillRect(this.posX,this.posY,this.width,this.height)};var Pong=Pong||{};Pong.Paddle=function(e,t){"use strict";this.parent=Pong.Rectangle.prototype;this.parent.constructor.call(this,e);this.width=t.width;this.height=t.height;this.posX=t.posX;this.posY=t.posY;this.moveSpeed=t.moveSpeed;this.color=t.color;this.origX=t.posX;this.origY=t.posY};Pong.Paddle.prototype=new Pong.Rectangle;Pong.Paddle.prototype.constructor=Pong.Paddle;Pong.Paddle.prototype.reset=function(){"use strict";this.setPosition(this.origX,this.origY);this.setSpeed(0,0)};var Pong=Pong||{};Pong.Ball=function(e,t){"use strict";this.parent=Pong.Rectangle.prototype;this.parent.constructor.call(this,e);this.width=t.width;this.height=t.height;this.posX=t.posX;this.posY=t.posY;this.speedX=t.speedX;this.speedY=t.speedY;this.color=t.color;this.origPosX=t.posX;this.origPosY=t.posY;this.origSpeedX=t.speedX;this.origSpeedY=t.speedY};Pong.Ball.prototype=new Pong.Rectangle;Pong.Ball.prototype.constructor=Pong.Paddle;Pong.Ball.prototype.reset=function(){"use strict";var e=function(e,t){if(e>t){throw"randInt: min > max"}if(e==t){return t}return Math.floor(Math.random()*(t-e+1)+e)};this.setPosition(this.origPosX,this.origPosY);this.setSpeed(this.origSpeedX,e(-200,200))};Pong.Ball.prototype.calcPaddleOffset=function(e){"use strict";var t=this.posY+this.height/2;var n=e.posY+e.height/2;var r=e.height/2;var i=t-n;return Math.round(i/r*100)};Pong.Ball.prototype.deflectOffPaddle=function(e){"use strict";var t=this.calcPaddleOffset(e)*8;if(this.speedX<0){this.posX=e.posX+e.width+1}else if(this.speedX>0){this.posX=e.posX-this.width-1}else{throw"Cannot bounce ball with zero speed."}this.speedX=-this.speedX;this.speedY=t};var Pong=Pong||{};Pong.Scoreboard=function(e,t){"use strict";this.context=e;this.leftScore=0;this.rightScore=0;this.fontFace=t.fontFace;this.fontSize=t.fontSize;this.fontColor=t.fontColor;this.leftPos=t.leftPos;this.rightPos=t.rightPos};Pong.Scoreboard.prototype.draw=function(){"use strict";this.context.font=this.fontSize+" "+this.fontFace;this.context.fillStyle=this.fontColor;this.context.fillText(String(this.leftScore),this.leftPos.x,this.leftPos.y);this.context.fillText(String(this.rightScore),this.rightPos.x,this.rightPos.y)};var Pong=Pong||{};Pong.Collision={NONE:"NONE",LEFT_EDGE:"LEFT_EDGE",TOP_EDGE:"TOP_EDGE",RIGHT_EDGE:"RIGHT_EDGE",BOTTOM_EDGE:"BOTTOM_EDGE",LEFT_PADDLE:"LEFT_PADDLE",RIGHT_PADDLE:"RIGHT_PADDLE"};Pong.CollisionDetector=function(e,t,n,r){"use strict";this.context=e;this.leftPaddle=t;this.rightPaddle=n;this.ball=r};Pong.CollisionDetector.prototype.isBallAtLeftEdge=function(){"use strict";return this.ball.posX<=0};Pong.CollisionDetector.prototype.isBallAtRightEdge=function(){"use strict";return this.ball.posX+this.ball.width>=this.context.canvas.width};Pong.CollisionDetector.prototype.isBallAtTopEdge=function(){"use strict";var e=this.ball.posY;return e<=0};Pong.CollisionDetector.prototype.isBallAtBottomEdge=function(){"use strict";var e=this.ball.posY+this.ball.height;return e>=this.context.canvas.height};Pong.CollisionDetector.prototype.detect=function(){"use strict";if(this.isBallAtLeftEdge()){return Pong.Collision.LEFT_EDGE}if(this.isBallAtRightEdge()){return Pong.Collision.RIGHT_EDGE}if(this.isBallAtTopEdge()){return Pong.Collision.TOP_EDGE}if(this.isBallAtBottomEdge()){return Pong.Collision.BOTTOM_EDGE}if(this.ball.isOverlapping(this.leftPaddle)){return Pong.Collision.LEFT_PADDLE}if(this.ball.isOverlapping(this.rightPaddle)){return Pong.Collision.RIGHT_PADDLE}return Pong.Collision.NONE};var Pong=Pong||{};Pong.ComputerAI=function(e,t){"use strict";this.rightPaddle=e;this.ball=t};Pong.ComputerAI.prototype.followClosely=function(){"use strict";var e=this.rightPaddle.posY+this.rightPaddle.height/2;var t=this.ball.posY+this.ball.height/2;var n=(t-e)/(this.rightPaddle.height/2);if(n>=1){this.rightPaddle.setSpeed(0,this.rightPaddle.moveSpeed)}else if(n<=-1){this.rightPaddle.setSpeed(0,-this.rightPaddle.moveSpeed)}else{this.rightPaddle.setSpeed(0,this.rightPaddle.moveSpeed*n)}};Pong.ComputerAI.prototype.followPerfectly=function(){"use strict";this.rightPaddle.posY=this.ball.posY-this.rightPaddle.height/2};Pong.ComputerAI.prototype.update=function(){this.followClosely()};var Pong=Pong||{};Pong.Game=function(e){"use strict";var t=this;e.canvas.style.background="#000";this.context=e;this.config=new Pong.Configuration;this.controls=this.config.controls;this.scoreboard=new Pong.Scoreboard(this.context,this.config.scoreboard);this.leftPaddle=new Pong.Paddle(this.context,this.config.leftPaddle);this.rightPaddle=new Pong.Paddle(this.context,this.config.rightPaddle);this.ball=new Pong.Ball(this.context,this.config.ball);this.collisionDetector=new Pong.CollisionDetector(this.context,this.leftPaddle,this.rightPaddle,this.ball);this.computerAI=new Pong.ComputerAI(this.rightPaddle,this.ball);window.onkeydown=function(e){t.onKeyDown(e)};window.onkeyup=function(e){t.onKeyUp(e)};window.requestAnimFrame=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(e){window.setTimeout(e,1e3/60)}}()};Pong.Game.prototype.clear=function(){"use strict";this.context.clearRect(0,0,this.context.canvas.width,this.context.canvas.height)};Pong.Game.prototype.update=function(e){"use strict";var t=this.collisionDetector.detect();switch(t){case Pong.Collision.LEFT_PADDLE:this.ball.deflectOffPaddle(this.leftPaddle);break;case Pong.Collision.RIGHT_PADDLE:this.ball.deflectOffPaddle(this.rightPaddle);break;case Pong.Collision.BOTTOM_EDGE:case Pong.Collision.TOP_EDGE:this.ball.speedY=-this.ball.speedY;break;case Pong.Collision.LEFT_EDGE:this.scoreboard.rightScore++;this.reset();break;case Pong.Collision.RIGHT_EDGE:this.scoreboard.leftScore++;this.reset();break;default:break}this.computerAI.update();this.leftPaddle.update(e);this.rightPaddle.update(e);this.ball.update(e)};Pong.Game.prototype.draw=function(){"use strict";this.clear();this.scoreboard.draw();this.leftPaddle.draw();this.rightPaddle.draw();this.ball.draw()};Pong.Game.prototype.onKeyDown=function(e){"use strict";switch(e.key){case this.controls.upKey:this.leftPaddle.speedY=-this.leftPaddle.moveSpeed;break;case this.controls.downKey:this.leftPaddle.speedY=this.leftPaddle.moveSpeed;break;case this.controls.pauseKey:this.isPaused=this.isPaused?false:true;break;case this.controls.resetKey:this.reset();break;default:break}};Pong.Game.prototype.onKeyUp=function(e){"use strict";switch(e.key){case this.controls.upKey:case this.controls.downKey:this.leftPaddle.speedY=0;break;default:break}};Pong.Game.prototype.reset=function(){"use strict";this.leftPaddle.reset();this.rightPaddle.reset();this.ball.reset()};Pong.Game.prototype.play=function(){"use strict";var e=this;var t=performance.now();var n=t;var r=0;var i=1e3/30;(function s(){window.requestAnimFrame(s);t=performance.now();r=t-n;n=t;if(e.isPaused){return}while(r>=i){e.update(i);r-=i}e.update(r);e.draw()})()}